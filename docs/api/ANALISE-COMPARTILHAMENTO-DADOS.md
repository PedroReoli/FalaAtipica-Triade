# üîÑ An√°lise Completa - Compartilhamento de Dados entre Aplica√ß√µes

**Data:** 16/10/2025  
**Status:** ‚úÖ An√°lise Completa

---

## üìã Sum√°rio

1. [Kids ‚Üí Tutors (Dados Enviados)](#1-kids--tutors-dados-enviados)
2. [Tutors ‚Üí Kids (Dados Enviados)](#2-tutors--kids-dados-enviados)
3. [Kids ‚Üí Pro (Dados Enviados)](#3-kids--pro-dados-enviados)
4. [Pro ‚Üí Kids (Dados Enviados)](#4-pro--kids-dados-enviados)
5. [Tutors ‚Üí Pro (Dados Enviados)](#5-tutors--pro-dados-enviados)
6. [Pro ‚Üí Tutors (Dados Enviados)](#6-pro--tutors-dados-enviados)
7. [Arquivos Compartilhados](#7-arquivos-compartilhados)
8. [Gaps Identificados](#8-gaps-identificados)
9. [Recomenda√ß√µes](#9-recomenda√ß√µes)

---

## 1. Kids ‚Üí Tutors (Dados Enviados)

### ‚úÖ Dados que EST√ÉO sendo compartilhados:

#### 1.1. **Progresso de Jogos** (API)
**Rota:** `POST /api/kids/progress`  
**Arquivo Destino:** `Mockup/shared/progress.json`

```json
{
  "id": "progress_xxx",
  "userId": "1",              // ‚úÖ ID da crian√ßa
  "gameId": "palavras",       // ‚úÖ ID do jogo
  "level": 1,                 // ‚úÖ N√≠vel do jogo
  "score": 100,               // ‚úÖ Pontua√ß√£o (%)
  "correctAnswers": 7,        // ‚úÖ Respostas corretas
  "wrongAnswers": 0,          // ‚úÖ Respostas erradas
  "timeSpent": 111,           // ‚úÖ Tempo em segundos
  "category": "animais",      // ‚úÖ Categoria do jogo
  "timestamp": "2025-10-16T01:56:06.322Z"  // ‚úÖ Data/hora
}
```

**Tutors Consome Em:**
- `GET /api/tutors/progress/:childId` - Progresso detalhado
- `GET /api/tutors/child/:childId` - Perfil da crian√ßa (Total Sess√µes, √öltimo Acesso)
- `GET /api/tutors/profile/:tutorId` - Perfil do tutor com crian√ßas

#### 1.2. **Eventos em Tempo Real** (Socket.IO)
**Eventos Emitidos pelo Kids:**

##### a) `game-started`
```javascript
{
  userId: "1",              // ‚úÖ ID da crian√ßa
  userName: "Jo√£o Silva",   // ‚úÖ Nome da crian√ßa
  gameId: "palavras",       // ‚úÖ ID do jogo
  gameName: "Jogo das Palavras",  // ‚úÖ Nome do jogo
  timestamp: "2025-10-16..."      // ‚úÖ Data/hora
}
```

**Tutors Escuta Como:** `child-game-started`  
**Usado Em:**
- `DashboardScreen.tsx` - Mostra toast de notifica√ß√£o
- `ChildProfileScreen.tsx` - Atualiza lista de dispositivos

##### b) `game-completed`
```javascript
{
  userId: "1",              // ‚úÖ ID da crian√ßa
  userName: "Jo√£o Silva",   // ‚úÖ Nome da crian√ßa
  gameId: "palavras",       // ‚úÖ ID do jogo
  gameName: "Jogo das Palavras",  // ‚úÖ Nome do jogo
  score: 100,               // ‚úÖ Pontua√ß√£o
  timestamp: "2025-10-16..."      // ‚úÖ Data/hora
}
```

**Tutors Escuta Como:** `child-game-completed`  
**Usado Em:**
- `DashboardScreen.tsx` - Mostra toast de notifica√ß√£o e recarrega dados
- `ProgressScreen.tsx` - Atualiza progresso em tempo real
- `ChildProfileScreen.tsx` - Atualiza perfil da crian√ßa e dispositivos

### ‚úÖ Status: **FUNCIONANDO PERFEITAMENTE**

---

## 2. Tutors ‚Üí Kids (Dados Enviados)

### ‚ùå Dados que DEVERIAM ser compartilhados mas N√ÉO EST√ÉO:

#### 2.1. **Configura√ß√µes de Privacidade**
**Exemplo de Uso:**
- Pais poderiam limitar tempo de jogo por dia
- Pais poderiam desabilitar certos jogos
- Pais poderiam definir hor√°rios permitidos

**Status:** ‚ùå N√ÉO IMPLEMENTADO

#### 2.2. **Mensagens de Incentivo**
**Exemplo de Uso:**
- Pais poderiam enviar mensagens que aparecem no Kids
- "Parab√©ns filho! Continue assim!" antes de jogar

**Status:** ‚ùå N√ÉO IMPLEMENTADO

#### 2.3. **Metas/Objetivos**
**Exemplo de Uso:**
- Pais definem meta: "Completar 5 jogos esta semana"
- Kids mostra progresso da meta

**Status:** ‚ùå N√ÉO IMPLEMENTADO

### üìä Status Atual:
**Tutors ‚Üí Kids:** Fluxo unidirecional (Kids envia, Tutors apenas consome)

---

## 3. Kids ‚Üí Pro (Dados Enviados)

### ‚úÖ Dados que EST√ÉO sendo compartilhados:

#### 3.1. **Progresso de Jogos** (API)
**Rota:** `GET /api/pro/patients` (l√™ `shared/progress.json`)

```javascript
// Pro consome os mesmos dados que Tutors
progressFile.progress.filter(p => p.userId === pacienteId)
```

**Pro Usa Em:**
- `GET /api/pro/patient/:patientId` - Detalhes do paciente
- `GET /api/pro/reports/:patientId` - Relat√≥rios do paciente

#### 3.2. **Eventos em Tempo Real** (Socket.IO)

**Pro Escuta:**
- `progress-updated` ‚úÖ
- `patient-game-started` ‚úÖ (relabeled de `game-started`)
- `patient-game-completed` ‚úÖ (relabeled de `game-completed`)

**Status:** ‚úÖ INFRAESTRUTURA PRONTA, mas...

### ‚ö†Ô∏è Problema Identificado:
**O Kids emite eventos, mas a API N√ÉO reemite para o Pro!**

**C√≥digo Atual (api/routes/kids.js):**
```javascript
// Emite apenas para tutores!
io.emit('progress-updated', { ... });
```

**Deveria emitir tamb√©m:**
```javascript
io.emit('patient-game-started', { ... });
io.emit('patient-game-completed', { ... });
```

---

## 4. Pro ‚Üí Kids (Dados Enviados)

### ‚úÖ Dados que EST√ÉO sendo compartilhados:

#### 4.1. **Atualiza√ß√£o de Dados do Paciente**
**Rota:** `PUT /api/pro/patient/:patientId`

```javascript
// Pro pode atualizar dados da crian√ßa
{
  nome: "Jo√£o Silva",
  idade: 8,
  diagnostico: "...",
  // etc
}
```

**Kids N√ÉO consome ativamente,** mas os dados ficam em `KIDS/usuarios.json`

#### 4.2. **Cria√ß√£o de Sess√µes**
**Rota:** `POST /api/pro/session`

```json
{
  "id": "session_xxx",
  "patientId": "1",         // ‚úÖ ID da crian√ßa
  "profissionalId": "prof_001",
  "tipo": "Terapia",
  "observacoes": "...",
  "atividades": [],
  "timestamp": "..."
}
```

**Salvo em:** `shared/sessions.json`

**Socket.IO Emite:** `session-created` para o tutor (n√£o para a crian√ßa)

### ‚ùå Dados que DEVERIAM ser compartilhados mas N√ÉO EST√ÉO:

#### 4.3. **Exerc√≠cios Personalizados**
**Exemplo:**
- Profissional cria exerc√≠cios customizados para crian√ßa
- Kids mostra esses exerc√≠cios como mini-jogos

**Status:** ‚ùå N√ÉO IMPLEMENTADO

#### 4.4. **Plano de Tratamento**
**Exemplo:**
- Profissional define: "Jogar 'Palavras' 3x por semana"
- Kids mostra lembretes e acompanha meta

**Status:** ‚ùå N√ÉO IMPLEMENTADO

---

## 5. Tutors ‚Üí Pro (Dados Enviados)

### ‚ö†Ô∏è Status: **FLUXO QUASE INEXISTENTE**

#### Dados que DEVERIAM ser compartilhados mas N√ÉO EST√ÉO:

##### 5.1. **Observa√ß√µes dos Pais**
**Exemplo:**
- Pais notam que crian√ßa teve dificuldade em casa
- Enviam observa√ß√£o que profissional v√™ no Pro

**Status:** ‚ùå N√ÉO IMPLEMENTADO

##### 5.2. **Confirma√ß√£o de Consultas**
**Exemplo:**
- Tutors confirma/cancela consulta agendada
- Pro recebe notifica√ß√£o em tempo real

**Status:** ‚ùå PARCIALMENTE - Agendas existem, mas sem intera√ß√£o

##### 5.3. **Solicita√ß√£o de Relat√≥rios**
**Exemplo:**
- Tutor solicita relat√≥rio mensal pelo app
- Pro recebe notifica√ß√£o de solicita√ß√£o

**Status:** ‚ùå N√ÉO IMPLEMENTADO

##### 5.4. **Feedback sobre Sess√µes**
**Exemplo:**
- Ap√≥s consulta, tutor avalia a sess√£o (1-5 estrelas)
- Pro v√™ feedback no dashboard

**Status:** ‚ùå N√ÉO IMPLEMENTADO

---

## 6. Pro ‚Üí Tutors (Dados Enviados)

### ‚úÖ Dados que EST√ÉO sendo compartilhados:

#### 6.1. **Agendas**
**Arquivo:** `Mockup/PRO/agendas.json` e `Mockup/TUTORS/agendas.json`

```json
{
  "id": "agenda_001",
  "criancaId": "1",         // ‚úÖ Compartilhado
  "tutorId": "tutor_001",   // ‚úÖ Compartilhado
  "profissionalId": "prof_001",  // ‚úÖ Compartilhado
  "data": "2025-10-18",     // ‚úÖ Compartilhado
  "horario": "14:00",       // ‚úÖ Compartilhado
  "status": "confirmada",   // ‚úÖ Compartilhado
  "observacoes": "..."      // ‚úÖ Compartilhado
}
```

**Tutors Consome Em:**
- `GET /api/tutors/agendas/:tutorId`
- `AgendaScreen.tsx`

**Status:** ‚úÖ FUNCIONANDO

#### 6.2. **Sess√µes Criadas** (Socket.IO)
**Evento:** `session-created`

```javascript
{
  sessionId: "session_xxx",
  patientName: "Jo√£o Silva",
  tipo: "Terapia",
  timestamp: "..."
}
```

**Tutors PODE escutar,** mas atualmente n√£o est√° configurado.

**Status:** ‚ö†Ô∏è EVENTO EXISTE, mas Tutors n√£o escuta

### ‚ùå Dados que DEVERIAM ser compartilhados mas N√ÉO EST√ÉO:

#### 6.3. **Relat√≥rios de Progresso**
**Exemplo:**
- Profissional gera relat√≥rio mensal
- Tutor recebe notifica√ß√£o e pode visualizar no app

**Status:** ‚ùå N√ÉO IMPLEMENTADO (relat√≥rios existem, mas sem visualiza√ß√£o)

#### 6.4. **Recomenda√ß√µes**
**Exemplo:**
- Profissional adiciona: "Praticar exerc√≠cio X em casa"
- Tutors mostra na tela de Dicas

**Status:** ‚ùå N√ÉO IMPLEMENTADO

#### 6.5. **Alertas Importantes**
**Exemplo:**
- Profissional marca paciente como "necessita aten√ß√£o urgente"
- Tutor recebe alerta no app

**Status:** ‚ùå N√ÉO IMPLEMENTADO

---

## 7. Arquivos Compartilhados

### 7.1. **Mockup/shared/progress.json**
**Compartilhado entre:** Kids, Tutors, Pro  
**Escrita:** Kids (via API)  
**Leitura:** Tutors (via API), Pro (via API)  
**Status:** ‚úÖ FUNCIONANDO

### 7.2. **Mockup/shared/sessions.json**
**Compartilhado entre:** Pro, Tutors  
**Escrita:** Pro (via API)  
**Leitura:** Pro (via API), Tutors (via API - AINDA N√ÉO IMPLEMENTADO)  
**Status:** ‚ö†Ô∏è PARCIALMENTE IMPLEMENTADO

### 7.3. **Mockup/KIDS/usuarios.json**
**Acessado por:** Kids, Tutors, Pro  
**Escrita:** Kids (registro), Pro (atualiza√ß√£o)  
**Leitura:** Todos  
**Status:** ‚úÖ FUNCIONANDO

### 7.4. **Mockup/TUTORS/agendas.json** e **Mockup/PRO/agendas.json**
**Problema:** DUPLICA√á√ÉO DE DADOS!  
**Status:** ‚ö†Ô∏è DOIS ARQUIVOS COM MESMOS DADOS

**Recomenda√ß√£o:** Mover para `Mockup/shared/agendas.json`

---

## 8. Gaps Identificados

### üî¥ **Cr√≠ticos (Afetam funcionalidade esperada)**

1. **Pro N√ÉO recebe eventos de jogos em tempo real**
   - Socket.IO emite apenas `progress-updated`, mas Pro escuta `patient-game-started/completed`
   - **Fix:** API deve reemitir eventos com nome correto

2. **Agendas duplicadas**
   - `TUTORS/agendas.json` e `PRO/agendas.json` t√™m dados id√™nticos
   - **Fix:** Mover para `shared/agendas.json`

3. **Tutors n√£o escuta `session-created`**
   - Pro cria sess√£o, mas Tutors n√£o √© notificado
   - **Fix:** Adicionar listener em `DashboardScreen.tsx`

### üü° **Importantes (Melhorariam UX)**

4. **Sem fluxo Tutors ‚Üí Kids para configura√ß√µes**
   - Pais n√£o podem limitar tempo, jogos, hor√°rios
   - **Fix:** Criar rota `POST /api/tutors/child-settings/:childId`

5. **Sem fluxo Tutors ‚Üí Pro para observa√ß√µes**
   - Pais n√£o podem enviar feedback para profissional
   - **Fix:** Criar rota `POST /api/tutors/observation`

6. **Pro n√£o pode enviar exerc√≠cios customizados**
   - Profissional n√£o pode criar atividades personalizadas
   - **Fix:** Criar sistema de exerc√≠cios customizados

### üü¢ **Nice-to-Have (Funcionalidades futuras)**

7. **Mensagens entre Tutor e Profissional**
8. **Sistema de notifica√ß√µes push**
9. **Relat√≥rios automatizados mensais**
10. **Dashboard de compara√ß√£o (crian√ßa vs m√©dia)**

---

## 9. Recomenda√ß√µes

### üîß **Corre√ß√µes Imediatas**

#### 9.1. Corrigir Eventos Socket.IO para Pro

**Arquivo:** `api/routes/kids.js` (linha 90-110)

```javascript
// ANTES (atual)
io.emit('progress-updated', {
  userId,
  childName: child.nome,
  gameId,
  gameName: getGameName(gameId),
  score,
  category,
  timestamp: progressData.timestamp
});

// DEPOIS (corrigido)
// Emitir para Tutors
io.emit('progress-updated', { /* dados */ });
io.emit('child-game-completed', { /* dados */ });

// Emitir para Pro (com prefixo 'patient')
io.emit('patient-game-started', {
  patientId: userId,
  patientName: child.nome,
  gameId,
  gameName: getGameName(gameId),
  timestamp: progressData.timestamp
});

io.emit('patient-game-completed', {
  patientId: userId,
  patientName: child.nome,
  gameId,
  gameName: getGameName(gameId),
  score,
  timestamp: progressData.timestamp
});
```

#### 9.2. Unificar Agendas

**Mover:**
- `Mockup/TUTORS/agendas.json` ‚Üí `Mockup/shared/agendas.json`
- `Mockup/PRO/agendas.json` ‚Üí DELETAR

**Atualizar APIs:**
- `api/routes/tutors.js` - Linha 355: `jsonService.readJSON('shared/agendas.json')`
- `api/routes/pro.js` - Adicionar rota `GET /api/pro/agendas/:professionalId`

#### 9.3. Adicionar Listener de Sess√µes no Tutors

**Arquivo:** `Tutors/src/screens/DashboardScreen.tsx`

```typescript
useEffect(() => {
  // ... existing listeners ...
  
  socketService.on('session-created', (data: any) => {
    if (currentUser && currentUser.criancasIds?.includes(data.patientId)) {
      success(`üìÖ Nova sess√£o agendada para ${data.patientName}`);
      loadAgendas(); // Recarrega agendas
    }
  });
  
  return () => {
    socketService.off('session-created');
  };
}, []);
```

### üìà **Melhorias Futuras (Pr√≥xima Sprint)**

1. **Criar sistema de configura√ß√µes para pais (Tutors ‚Üí Kids)**
2. **Implementar observa√ß√µes dos pais (Tutors ‚Üí Pro)**
3. **Adicionar relat√≥rios compartilhados (Pro ‚Üí Tutors)**
4. **Criar sistema de exerc√≠cios customizados (Pro ‚Üí Kids)**

---

## üìä Resumo Executivo

| Fluxo | Status Atual | Dados Enviados | Completude |
|-------|--------------|----------------|------------|
| **Kids ‚Üí Tutors** | ‚úÖ FUNCIONANDO | Progresso, Eventos RT | 100% |
| **Tutors ‚Üí Kids** | ‚ùå INEXISTENTE | Nenhum | 0% |
| **Kids ‚Üí Pro** | ‚ö†Ô∏è PARCIAL | Progresso (API), Eventos (falha) | 50% |
| **Pro ‚Üí Kids** | ‚ö†Ô∏è PARCIAL | Atualiza√ß√£o cadastro, Sess√µes | 40% |
| **Tutors ‚Üí Pro** | ‚ùå QUASE INEXISTENTE | Agendas (read-only) | 10% |
| **Pro ‚Üí Tutors** | ‚ö†Ô∏è PARCIAL | Agendas, Eventos (n√£o escutados) | 60% |

### üéØ Prioridades:

1. **Alta:** Corrigir eventos Socket.IO para Pro
2. **Alta:** Unificar arquivo de agendas
3. **Alta:** Adicionar listener `session-created` no Tutors
4. **M√©dia:** Implementar fluxo Tutors ‚Üí Pro (observa√ß√µes)
5. **M√©dia:** Implementar fluxo Tutors ‚Üí Kids (configura√ß√µes)
6. **Baixa:** Sistema de exerc√≠cios customizados

---

**Documento gerado em:** 16/10/2025  
**Pr√≥xima revis√£o:** Ap√≥s implementa√ß√£o das corre√ß√µes cr√≠ticas

